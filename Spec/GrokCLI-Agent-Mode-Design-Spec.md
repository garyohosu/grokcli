# Grok CLI – Agent Mode Design Specification

## 1. General Principles

1. All internal prompts (Agents.md, interview.md, planner.md, etc.) must be written in English.
2. However, all output generated by the agent must match the user's input language.
3. The agent must operate entirely through Markdown files inside a dedicated workspace directory:
   ```
   ~/.grok_agent/
   ```
4. The agent should be deterministic, restart-safe, and able to resume after interruption.

## 2. Workspace File Structure

All files are located in `~/.grok_agent/`:

| File | Created by | Purpose |
|------|------------|----------|
| Agents.md | static | Agent Controller specification |
| interview.md | static | Interactive Goal Generator |
| goal.md | auto | user's goal |
| planner.md | auto | task breakdown |
| executor.md | auto | execution prompt |
| result.md | auto | raw execution output |
| reviewer.md | auto | analysis and feedback |
| final_report.md | auto | final deliverable |
| meta.json | auto | metadata (goal hash, loops, timestamps) |

## 3. Agent Responsibilities

### Agents.md ("Agent Controller")
Defines the entire multi-step AI agent loop:
1. Initialization
2. Load/update goal
3. Reset files if the goal changed
4. Generate planner → executor → result → reviewer
5. Loop until completed or max loops
6. Produce final_report.md

### interview.md ("Interactive Goal Generator")
- Reads user input
- Asks intelligent questions
- Produces a clear goal.md
- Ensures safety and clarity

## 4. Goal Reset Policy

If a new goal is detected:
1. Delete auto-generated files
2. Re-run interview.md
3. Create a new goal.md
4. Restart the agent loop

## 5. Agent Loop Specification

- Maximum loops: **5**
- Steps:
  1. Read goal.md
  2. Generate planner.md
  3. Generate executor.md
  4. Execute → result.md
  5. Review → reviewer.md
  6. If complete → final_report.md
  7. Else update tasks and repeat

## 6. Error Handling

1. Missing file → regenerate
2. Invalid meta.json → recreate
3. Empty result → note in reviewer
4. Unsafe content → stop workflow

## 7. Language Output Rule (Mandatory)

All outputs must be generated in the same language as the user's latest input.

## 8. Expected UX Flow

User:
```
grokcli
```

Grok CLI:
1. Runs interview
2. Generates goal.md
3. Runs agent loop
4. Outputs final_report.md

## 9. New Goal Behavior

If the user changes the goal, restart the entire process automatically.
